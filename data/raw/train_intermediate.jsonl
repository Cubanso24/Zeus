{"instruction": "Calculate total bytes transferred by each source IP", "input": "", "output": "index=zeek sourcetype=zeek_conn | stats sum(orig_bytes) as total_sent, sum(resp_bytes) as total_received by id.orig_h | eval total_sent_MB=round(total_sent/1048576,2) | eval total_received_MB=round(total_received/1048576,2) | sort -total_sent"}
{"instruction": "Find top talkers by connection count", "input": "", "output": "index=zeek sourcetype=zeek_conn | stats count as connections by id.orig_h, id.resp_h | sort -connections | head 20"}
{"instruction": "Show average connection duration by service", "input": "", "output": "index=zeek sourcetype=zeek_conn | stats avg(duration) as avg_duration, count by service | eval avg_duration=round(avg_duration,2) | sort -avg_duration"}
{"instruction": "Count unique destination IPs contacted by each source", "input": "", "output": "index=zeek sourcetype=zeek_conn | stats dc(id.resp_h) as unique_destinations by id.orig_h | where unique_destinations>50 | sort -unique_destinations"}
{"instruction": "Identify processes with the most network connections", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=3 | stats count as connection_count, dc(DestinationIp) as unique_destinations by Image | sort -connection_count | head 20"}
{"instruction": "Find hosts generating the most DNS NXDOMAIN errors", "input": "", "output": "index=zeek sourcetype=zeek_dns rcode_name=\"NXDOMAIN\" | stats count as nxdomain_count by id.orig_h | where nxdomain_count>100 | sort -nxdomain_count"}
{"instruction": "Calculate DNS query volume by source IP", "input": "", "output": "index=zeek sourcetype=zeek_dns | stats count as query_count by id.orig_h | where query_count>1000 | sort -query_count"}
{"instruction": "Show HTTP status code distribution", "input": "", "output": "index=zeek sourcetype=zeek_http | stats count by status_code | eventstats sum(count) as total | eval percentage=round(count/total*100,2) | sort -count"}
{"instruction": "Track file creation rates to detect ransomware", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=11 | streamstats time_window=1m count as files_created by Computer, Image | where files_created>100 | table _time Computer Image files_created TargetFilename"}
{"instruction": "Find processes with unusual parent-child relationships", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 (ParentImage=\"*WINWORD.EXE\" OR ParentImage=\"*EXCEL.EXE\") (Image=\"*powershell.exe\" OR Image=\"*cmd.exe\") | stats count by Computer, ParentImage, Image, CommandLine"}
{"instruction": "Show connection volume over time in 1-hour buckets", "input": "", "output": "index=zeek sourcetype=zeek_conn | timechart span=1h count by proto"}
{"instruction": "Track DNS query trends throughout the day", "input": "", "output": "index=zeek sourcetype=zeek_dns | timechart span=1h count by qtype_name"}
{"instruction": "Display HTTP traffic patterns by method over time", "input": "", "output": "index=zeek sourcetype=zeek_http | timechart span=30m count by method"}
{"instruction": "Monitor SSL TLS version usage trends", "input": "", "output": "index=zeek sourcetype=zeek_ssl | timechart span=1h count by version"}
{"instruction": "Track failed connection attempts over time", "input": "", "output": "index=zeek sourcetype=zeek_conn conn_state=\"S0\" | timechart span=15m count by id.resp_p"}
{"instruction": "Show data transfer volume trends", "input": "", "output": "index=zeek sourcetype=zeek_conn | timechart span=1h sum(orig_bytes) as outbound, sum(resp_bytes) as inbound"}
{"instruction": "Analyze HTTP error rates over time", "input": "", "output": "index=zeek sourcetype=zeek_http status_code>=400 | timechart span=30m count by status_code"}
{"instruction": "Monitor alert frequency by time of day", "input": "", "output": "index=suricata event_type=alert | eval hour=strftime(_time,\"%H\") | stats count by hour, alert.severity | sort hour"}
{"instruction": "Track unique destinations contacted per hour", "input": "", "output": "index=zeek sourcetype=zeek_conn | bucket _time span=1h | stats dc(id.resp_h) as unique_dests by _time"}
{"instruction": "Show process creation frequency by host over time", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 | timechart span=1h count by Computer"}
{"instruction": "Correlate alerts with flow data for context", "input": "", "output": "index=suricata flow_id=* | stats values(event_type) as event_types, values(alert.signature) as signatures, sum(flow.bytes_toserver) as bytes_sent, sum(flow.bytes_toclient) as bytes_received by flow_id, src_ip, dest_ip | where mvcount(event_types)>1"}
{"instruction": "Find hosts triggering multiple alert categories", "input": "", "output": "index=suricata event_type=alert | stats dc(alert.category) as unique_categories, values(alert.signature) as signatures, count by src_ip | where unique_categories>3 | sort -count"}
{"instruction": "Identify noisy signatures for tuning", "input": "", "output": "index=suricata event_type=alert earliest=-7d | stats count by alert.signature_id, alert.signature | where count>500 | sort -count"}
{"instruction": "Find unusual outbound connections from Office applications", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=3 (Image=\"*WINWORD.EXE\" OR Image=\"*EXCEL.EXE\" OR Image=\"*POWERPNT.EXE\") NOT (DestinationIp=\"10.*\" OR DestinationIp=\"172.16.*\" OR DestinationIp=\"192.168.*\") | stats count by Computer, Image, DestinationIp, DestinationPort"}
{"instruction": "Detect beaconing behavior by analyzing connection intervals", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=3 | bucket _time span=5m | stats count by _time, Computer, Image, DestinationIp | stats dc(_time) as time_intervals, count as total_connections by Computer, Image, DestinationIp | where time_intervals>50 AND total_connections>100"}
{"instruction": "Count process executions by user across all hosts", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 | stats count by User, Image | sort -count"}
{"instruction": "Identify processes running from suspicious locations", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 (Image=\"*\\\\Temp\\\\*\" OR Image=\"*\\\\Downloads\\\\*\" OR Image=\"*\\\\AppData\\\\*\") | stats count by Computer, Image, ParentImage | sort -count"}
{"instruction": "Find PowerShell executions with encoded commands", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 Image=\"*powershell.exe\" (CommandLine=\"*-enc*\" OR CommandLine=\"*-encodedcommand*\") | stats count by Computer, User, CommandLine"}
{"instruction": "Correlate Zeek DNS with Sysmon process activity", "input": "", "output": "(index=zeek sourcetype=zeek_dns) OR (sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=22) | eval dns_query=coalesce(query,QueryName) | eval source_ip=coalesce(id.orig_h,Computer) | stats values(dns_query) as domains_queried, values(Image) as processes by source_ip"}
{"instruction": "Match Suricata alerts with Sysmon network connections", "input": "", "output": "(index=suricata event_type=alert) OR (sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=3) | eval src=coalesce(src_ip,Computer) | eval dest=coalesce(dest_ip,DestinationIp) | stats values(alert.signature) as alerts, values(Image) as processes by src, dest"}
{"instruction": "Detect port scanning activity from internal hosts", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=3 | stats dc(DestinationPort) as unique_ports, dc(DestinationIp) as unique_ips by Computer, Image | where unique_ports>20 OR unique_ips>50"}
{"instruction": "Find PowerShell making external network connections", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=3 Image=\"*powershell.exe\" Initiated=true NOT (DestinationIp=\"10.*\" OR DestinationIp=\"172.16.*\" OR DestinationIp=\"192.168.*\") | stats count by Computer, DestinationIp, DestinationPort"}
{"instruction": "Identify rare process executions across the environment", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 | stats count by Image | where count<5 | sort count"}
{"instruction": "Find processes spawned by system accounts", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 User=\"NT AUTHORITY\\\\SYSTEM\" | stats count by Image, ParentImage | sort -count"}
{"instruction": "Track LOLBin usage across the network", "input": "", "output": "sourcetype=\"XmlWinEventLog:Microsoft-Windows-Sysmon/Operational\" EventCode=1 (Image=\"*certutil.exe\" OR Image=\"*bitsadmin.exe\" OR Image=\"*mshta.exe\" OR Image=\"*regsvr32.exe\") | stats count by Image, Computer, CommandLine"}
{"instruction": "Identify hosts with most failed connections", "input": "", "output": "index=zeek sourcetype=zeek_conn conn_state=\"S0\" | stats count as failed_connections by id.orig_h | sort -failed_connections | head 20"}
{"instruction": "Find unusual port usage by counting connections per port", "input": "", "output": "index=zeek sourcetype=zeek_conn | stats count as connection_count, dc(id.orig_h) as unique_sources by id.resp_p | where connection_count<10 AND unique_sources<3 | sort -connection_count"}
{"instruction": "Calculate average HTTP response size by host", "input": "", "output": "index=zeek sourcetype=zeek_http | stats avg(response_body_len) as avg_response_size, count by host | eval avg_response_size_KB=round(avg_response_size/1024,2) | sort -avg_response_size_KB | head 20"}
{"instruction": "Detect scanning activity from external sources", "input": "", "output": "index=suricata event_type=alert alert.signature=\"*scan*\" | stats dc(dest_ip) as targets, dc(dest_port) as ports, count by src_ip | where targets>10 OR ports>10 | sort -targets"}
{"instruction": "Find repeated alerts between same source and destination", "input": "", "output": "index=suricata event_type=alert | stats count, values(alert.signature) as signatures, earliest(_time) as first_seen, latest(_time) as last_seen by src_ip, dest_ip | where count>20 | eval duration=last_seen-first_seen | convert ctime(first_seen) ctime(last_seen)"}
